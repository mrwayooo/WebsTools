<div id="qr-tool" class="tool-content active">
    <h2>QR Generator</h2>
    <input type="text" id="qrInput" placeholder="Enter URL or Text">
    <button class="btn-gen" onclick="genQR()">Generate QR</button>
    <div id="qr-result-box">
        <img id="qrImg" class="result-img">
        <button id="dlQR" class="btn-down" onclick="downloadImg('qrImg', 'qrcode.png')">Download QR</button>
    </div>
</div>

<div id="yt-tool" class="tool-content">
    <h2>YouTube Thumbnail</h2>
    <input type="text" id="ytInput" placeholder="Paste YouTube Link">
    <button class="btn-gen" onclick="genYT()">Get Thumbnail</button>
    <div id="yt-result-box">
        <img id="ytImg" class="result-img">
        <button id="dlYT" class="btn-down" onclick="downloadImg('ytImg', 'thumbnail.jpg')">Download Thumbnail</button>
    </div>
</div>

<script>
    // --- ฟังก์ชันหลักสำหรับการสร้างรูป (ปรับปรุงให้โชว์ปุ่มดาวน์โหลด) ---
    function genQR() {
        const val = document.getElementById('qrInput').value;
        if(!val) return alert("Please enter text");
        const img = document.getElementById('qrImg');
        const dlBtn = document.getElementById('dlQR');
        
        img.src = `https://api.qrserver.com/v1/create-qr-code/?size=500x500&data=${encodeURIComponent(val)}`;
        img.style.display = "block";
        img.onload = () => dlBtn.style.display = "block"; // โชว์ปุ่มเมื่อรูปโหลดเสร็จ
    }

    function genYT() {
        const url = document.getElementById('ytInput').value;
        let videoId = "";
        if(url.includes("v=")) videoId = url.split("v=")[1].substring(0, 11);
        else if(url.includes("be/")) videoId = url.split("be/")[1].substring(0, 11);
        
        if(videoId) {
            const img = document.getElementById('ytImg');
            const dlBtn = document.getElementById('dlYT');
            img.src = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;
            img.style.display = "block";
            img.onload = () => dlBtn.style.display = "block";
        } else {
            alert("Invalid YouTube Link");
        }
    }

    // --- ฟังก์ชัน Download อเนกประสงค์ (ใช้ได้กับทุกรูป) ---
    async function downloadImg(imgId, fileName) {
        const img = document.getElementById(imgId);
        try {
            // ดึงข้อมูลรูปภาพเป็น Blob
            const response = await fetch(img.src);
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            
            // สร้างลิงก์ชั่วคราวเพื่อดาวน์โหลด
            const a = document.createElement("a");
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            
            // ล้างหน่วยความจำ
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        } catch (err) {
            alert("Download failed. Please right-click and 'Save Image As'");
            console.error(err);
        }
    }
    
    // อย่าลืมฟังก์ชัน openTab และ checkPass ตัวเดิมนะครับ
</script>
